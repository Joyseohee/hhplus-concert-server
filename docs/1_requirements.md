# 🎤 콘서트 예약 서비스

## 📝 프로젝트 개요

이 프로젝트는 콘서트 예약 서비스를 위한 대기열 시스템을 설계하는 것입니다.
사용자는 대기열에 등록하고, 좌석을 점유하며, 결제를 통해 좌석 소유권을 획득할 수 있습니다.
이 시스템은 동시성 제어, 상태 기반 흐름 제어, 무결성 보장 등을 고려하여 설계하였습니다.

## 📚 설계 문서
- [요구사항 분석](1_requirements.md)
- [ERD](2_erd.md)
- [시퀀스 다이어그램](3_sequence_diagram.md)
- [상태 다이어그램](4_state_diagram.md)
- [API 명세](https://joyseohee.github.io/hhplus-concert-server)

## 📋 요구사항

### 기능적 요구사항
1. **대기열 토큰 관리**

    * **토큰 발급**: 사용자가 대기열에 등록되고, `WAITING` 상태의 토큰을 발급받는다.
    * **토큰 조회**: `tokenId`로 자신의 상태(`WAITING`/`ACTIVE`/`EXPIRED`), 순번, 남은 시간 확인.
    * **상태 전이**:

        * `WAITING` → `ACTIVE` (선착순 제한 인원 진입 시)
        * `ACTIVE` → `EXPIRED` (만료 시간 경과 또는 결제 완료 시)
    * **토큰 만료**: 만료된 토큰은 조회 시 `EXPIRED` 처리되고, 다시 등록해야 함.

2. **콘서트 일정·좌석 조회**

    * **예약 가능 일자 조회**: `ACTIVE` 토큰 소지자만 이용.
    * **예약 가능 좌석 조회**: 특정 일자(공연)에 1\~50번 좌석별 점유 가능 여부, 현재 점유자 유무 확인.

3. **좌석 점유 요청**

    * **1인 1좌석**: 한 번에 한 좌석만 점유.
    * **TTL 5분**: 점유 후 5분 내 결제 요청이 없으면 자동 해제.

4. **잔액 관리**

    * **잔액 조회**: 사용자별 현재 잔액 확인.
    * **잔액 충전**: 지정 금액만큼 잔액 추가.

5. **결제 처리**

    * **잔액 차감**: 좌석 가격만큼 즉시 차감.
    * **소유권 부여**: 결제 성공 시 해당 좌석을 사용자에 귀속.
    * **토큰 만료**: 결제 완료 직후 토큰 상태를 `EXPIRED`로 전환.

---

### 비기능적 요구사항 (Non-functional)

1. **동시성 제어**

    * **대기열 진입**: `SELECT FOR UPDATE` 기반 비관적 락으로 순서 보장.
    * **좌석 점유**: DB 수준 `UNIQUE` 혹은 낙관적 락으로 중복 점유 방지.

2. **확장성 & 분산 운영**

    * **다중 인스턴스** 환경에서도 일관된 상태 유지.
    * 향후 Redis/Kafka 전환 용이하도록 인터페이스 기반 설계 요함.

3. **무결성 & 일관성**

    * 결제 실패 시 좌석 점유·토큰 상태 롤백 보장.
    * 잔액 부족, 잘못된 토큰·좌석 요청에 대해 명확한 에러 코드 및 HTTP 상태 반환.

4. **인증**

    * `Client-Id`와 `Queue-Token` 헤더로 사용자·토큰 검증.
    * 토큰 UUID 충분한 랜덤성 보장.

5. **신속성 & 가독성**

    * API 스펙(`OpenAPI`) 자동 문서화 및 Mock 데이터 제공.
    * 실무 상황이라는 가정 하에 프론트 엔드에게 빠르게 API를 제공할 수 있도록, 구현을 최대한 단순화.
    * 응답 형식(`code`/`message`) 통일.